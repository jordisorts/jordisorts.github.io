<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dades de la Lliga de Horseball</title>
    <!-- Enlace a Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Estilo para el select estándar */
        .form-select {
            width: 100%; /* Asegúrate de que ocupe el 100% del ancho */
        }
    </style>
</head>
<body>

<div class="container my-4">
    <h1 class="text-center mb-4">LLiga Catalana Horseball 2024-25</h1>

    <!-- Select per filtrar per jornada i categoria -->
    <div class="row mb-4">
        <div class="col-md-4">
            <label for="filtro-jornada" class="form-label">Filtrar per Jornada:</label>
            <select id="filtro-jornada" class="form-select">
                <option value="todos">Tots</option>
            </select>
        </div>
        <div class="col-md-4">
            <label for="filtro-categoria" class="form-label">Filtrar per Categoria:</label>
            <select id="filtro-categoria" class="form-select">
                <option value="todos">Tots</option>
            </select>
        </div>
        <div class="col-md-4" id="equipo-container" style="display: none;"> <!-- Ocultar inicialmente -->
            <label for="filtro-equipo" class="form-label">Equip:</label> <!-- Cambiar título -->
            <select id="filtro-equipo" class="form-select">
                <option value="todos">Tots</option>
            </select>
        </div>
    </div>

    <button id="btn-clear-filters" class="btn btn-danger mb-4">Borrar Filtres</button> <!-- Botón para borrar filtros -->

    <!-- Contenedor para la tabla (pantallas grandes y móviles) -->
    <div class="table-responsive"> <!-- Contenedor responsive -->
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Data</th>
                    <th class="text-center">Jornada</th>
                    <th>Localització</th>
                    <th class="text-center">Hora Partit</th>
                    <th class="text-center">Hora Escalfament</th>
                    <th>Categoria</th>
                    <th class="text-end">Local</th>
                    <th class="text-center">-</th> <!-- Separador alineado al centro sin título -->
                    <th>Visitant</th>
                </tr>
            </thead>
            <tbody id="tabla-datos">
                <!-- Els dades del JSON filtrats es mostraran aquí -->
            </tbody>
        </table>
    </div>
</div>

<!-- Enlace a Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!-- Enlace a jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
    let partits = [];

    // Función para formatear la fecha en formato español (DD/MM/YYYY)
    function formatearFecha(fecha) {
        const partes = fecha.split('/');
        return `${partes[1]}/${partes[0]}/${partes[2]}`;
    }

    // Función para llenar los select boxes dinámicamente
    function llenarSelectBox(partits, campo, selectId) {
        const valoresUnicos = [...new Set(partits.map(juego => juego[campo]))]; // Obtener valores únicos
        const selectBox = document.getElementById(selectId);
        selectBox.innerHTML = '<option value="todos">Tots</option>'; // Reiniciar el select
        valoresUnicos.forEach(valor => {
            const option = document.createElement('option');
            option.value = valor;
            option.textContent = valor;
            selectBox.appendChild(option);
        });
    }

    // Función para llenar el select box de equipos filtrando por categoría
    function llenarSelectEquipoPorCategoria(categoria) {
        const selectEquipo = document.getElementById('filtro-equipo');
        selectEquipo.innerHTML = '<option value="todos">Tots</option>'; // Reiniciar el select

        const equipos = new Set(partits
            .filter(juego => categoria === 'todos' || juego.CATEGORIA === categoria) // Filtrar por categoría
            .flatMap(juego => [juego.LOCAL, juego.VISITANT])); // Obtener equipos únicos

        // Convertir a un array y eliminar "FASE FINAL"
        const equipoArray = Array.from(equipos).filter(equipo => equipo !== "FASE FINAL");

        equipoArray.forEach(equipo => {
            const option = document.createElement('option');
            option.value = equipo;
            option.textContent = equipo;
            selectEquipo.appendChild(option);
        });
    }

    // Función para mostrar los datos filtrados en la tabla
    function mostrarDatos(filtros) {
        const tabla = document.getElementById('tabla-datos');
        tabla.innerHTML = ''; // Limpiar la tabla

        partits.forEach(juego => {
            const cumpleFiltroJornada = (filtros.jornada === "todos" || juego.JORNADA == filtros.jornada);
            const cumpleFiltroCategoria = (filtros.categoria === "todos" || juego.CATEGORIA === filtros.categoria);
            const cumpleFiltroEquipo = (filtros.equipo === "todos" || (filtros.equipo === juego.LOCAL || filtros.equipo === juego.VISITANT));

            if (cumpleFiltroJornada && cumpleFiltroCategoria && cumpleFiltroEquipo) {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${formatearFecha(juego.DATA) || '-'}</td>
                    <td class="text-center">${juego.JORNADA !== undefined ? juego.JORNADA : '-'}</td>
                    <td>${juego.LLOC !== undefined ? juego.LLOC : '-'}</td>
                    <td class="text-center">${juego["H.PARTIT"] !== undefined ? juego["H.PARTIT"] : '-'}</td>
                    <td class="text-center">${juego["H.ESCALF."] !== undefined ? juego["H.ESCALF."] : '-'}</td>
                    <td>${juego.CATEGORIA !== undefined ? juego.CATEGORIA : '-'}</td>
                    <td class="text-end">${juego.LOCAL !== undefined ? juego.LOCAL : '-'}</td>
                    <td class="text-center">-</td> <!-- Separador alineado al centro -->
                    <td>${juego.VISITANT !== undefined ? juego.VISITANT : '-'}</td>
                `;
                tabla.appendChild(fila);
            }
        });
    }

    // Función para cargar y mostrar los datos del JSON
    async function cargarDatos() {
        try {
            const response = await fetch('horseball-2024-2025.json');
            const data = await response.json();
            partits = data.Partits_Complet; // Cambiar a la nueva clave

            // Llenar los select boxes
            llenarSelectBox(partits, 'JORNADA', 'filtro-jornada');
            llenarSelectBox(partits, 'CATEGORIA', 'filtro-categoria');

            // Mostrar todos los datos inicialmente
            mostrarDatos({
                jornada: 'todos',
                categoria: 'todos',
                equipo: 'todos', // Cambiado a cadena para selección única
            });

            // Añadir eventos de cambio para los filtros
            document.getElementById('filtro-jornada').addEventListener('change', (event) => {
                mostrarDatos({
                    jornada: event.target.value,
                    categoria: document.getElementById('filtro-categoria').value,
                    equipo: document.getElementById('filtro-equipo').value, // Obtener selección única
                });
            });

            document.getElementById('filtro-categoria').addEventListener('change', (event) => {
                const categoriaSeleccionada = event.target.value;
                mostrarDatos({
                    jornada: document.getElementById('filtro-jornada').value,
                    categoria: categoriaSeleccionada,
                    equipo: document.getElementById('filtro-equipo').value, // Obtener selección única
                });
                // Mostrar el select de equipo solo después de seleccionar una categoría
                document.getElementById('equipo-container').style.display = categoriaSeleccionada === 'todos' ? 'none' : 'block';

                // Llenar el select de equipos filtrando por la categoría seleccionada
                llenarSelectEquipoPorCategoria(categoriaSeleccionada);
            });

            document.getElementById('filtro-equipo').addEventListener('change', (event) => {
                mostrarDatos({
                    jornada: document.getElementById('filtro-jornada').value,
                    categoria: document.getElementById('filtro-categoria').value,
                    equipo: event.target.value, // Obtener selección única
                });
            });

            // Añadir evento para el botón de borrar filtros
            document.getElementById('btn-clear-filters').addEventListener('click', () => {
                // Reiniciar los select boxes
                document.getElementById('filtro-jornada').value = 'todos';
                document.getElementById('filtro-categoria').value = 'todos';
                document.getElementById('filtro-equipo').value = 'todos'; // Reiniciar el select único
                document.getElementById('equipo-container').style.display = 'none'; // Ocultar el select de equipos
                mostrarDatos({
                    jornada: 'todos',
                    categoria: 'todos',
                    equipo: 'todos', // Cambiado a cadena para selección única
                });
            });

        } catch (error) {
            console.error('Error al cargar los datos:', error);
        }
    }

    // Llamar a la función para cargar los datos cuando se cargue la página
    window.onload = cargarDatos;
</script>

</body>
</html>
